# Руководство к проекту

## Базовая концепция

Это шаблон проекта, который мы используем в Ancros для верстки и разработки фронтенда. 
Проект легко адаптируется, если необходимо сделать SPA приложение.

Сборк осуществляется с помощью **Gulp 4**, скрипты компилируются с помощью **[ES Build](https://github.com/evanw/esbuild)**, для стилей используется **Stylus**. Гибкая конфигурация позволяет легко настраивать проект под любые нужды.

Версия node.js - 16

# Начало работы

## Устанавливаем зависимости

`npm i`

### Команды для запуска

`npm run start` — запуск проекта с сервером в режиме наблюдения за изменениями файлов и открытием окна браузера

`npm run dev` — то же, что и `start` только без открытия окна браузера

`npm run build` — компиляция проекта в папку **build** в продакшен режиме (отлкючение Sourcemaps, сжатие стилей, сжатие скриптов и тд)


## Метод сборки js

Проект собирается с помощью **ES Build**. ES6 код компилируется в обычный js поддерживаемый браузером.

Данный вид сборки позволяет использовать `import`, `export` и все современные фичи JavaScript, в том числе `async await`. 

## Шаблонизатор

Для шаблонизации используется движок **nunjucks**. Примеры можно посмотреть на официальном сайте — [https://mozilla.github.io/nunjucks/](https://mozilla.github.io/nunjucks/). В файле **index.njk** продемонстрирован пример добавления других файлов в шаблон через команду `include`.

В шаблоны можно передавать данные, как с сервера при компиляции (папка data), так и прописывать в HTML.
Доступ к данным осуществляется через двойные скобки  
Остальные методы работы с данными, такие как циклы и условия, можно посмотреть в документации [https://mozilla.github.io/nunjucks/](https://mozilla.github.io/nunjucks/)

## Стили и препроцессор

Для препроцессинга стилей используется **Stylus**. 

Подробнее о **Stylus** — [http://stylus-lang.com/](http://stylus-lang.com/)

## Https режим

Для запуска сервера в режиме \*\*https\*\* нужно создать файл .env из файла .env.example и прописать путь к файлам ключей (подробости ниже).

## Добавляем сертификат для https

Чтобы локальный сервер работал через **https**, необходимо добавить существующий сертификат или создать новый. Далее рассмотрены 2 варианта, когда уже есть готовый сертификат и когда нет.

### 1) Создаем сертификат

1\. Скачиваем файл для Windows [https://github.com/FiloSottile/mkcert/releases](https://github.com/FiloSottile/mkcert/releases)  
Например мы скачали `mkcert-v1.4.1-windows-amd64.exe`  
Сохраняем в любую пустую папку

2\. Запускаем **PowerShell** в режиме администратора

3\. В **PowerShell** переходим в папку с файлом `mkcert-v1.4.1-windows-amd64.exe` например командой `cd D:\project\path`

4\. Устанавливаем локальный центр сертификации командой: `.\mkcert-v1.4.1-windows-amd64.exe -install`

5\. Создаем сертификаты для `localhost`: `.\mkcert-v1.4.1-windows-amd64.exe localhost`

6\. Если все прошло успешно, в папке появляются 2 файла:  
`localhost.pem` - сертификат  
`localhost-key.pem` - ключ  

7\. Копируем эти файлы в любое удобное место или оставляем как есть.

8\. В данном проекте путь к файлу должен быть прописан через переменную окружения. Переменные окружения прописываются в файле `.env`, который не заливается в репозиторий.  
Пример файла есть в папке проекта `.env.example`. Нужно создать копию и назвать его `.env`.  
Заменить пути на реальные, которые ведут к вашим файлам сертификатов.

`HTTPSKEY=PATH\TO\FILE HTTPSCRT=PATH\TO\FILE`  
**Важно:** это могут быть как pem файлы, так и файлы с расширением `.key`, `.crt`.  
После добавления файла сертификата, проект будет запускаться по адресу [https://localhost:8080](https://localhost:8080)

### 2) Используем существующий

Для добавления существующего сертификата, необходимо только создать копию файла `.env.example` и переименовать ее в `.env` и указать пути к сертификатам.

## Описание важных файлов

`.browserslistrc` - содержит список всех браузеров, которым необходимо проставлять префиксы в стилях.

`.env.example` - пример файла с переменными окружения, необходимыми для проекта. При желании использовать **HTTPS**, нужно сделать его копию, переименовать в `.env` и обновить записанные в нем переменные окружения.